# Hayasaka

Suite of discord bots.

- Hayasaka: takes song suggestions and adds them to Google Sheet. Other features TBD.
- Manager: manages redeployment of bots when code is updated (currently only supports rebooting Hayasaka).

## Installation

Requires `node` (using v8.5.0 in production) and `npm`. To set up:

```bash
npm install
```

## Running Bots

For now, bots should be run from the root directory of the project (subject to change).

### Hayasaka

```bash
npm start
```

### Manager

```bash
node -r esm manager/main.js
```

Starting up Manager will start up Hayasaka as a subprocess.

## Discord Commands

### Hayasaka

- `!ping`: Messages `pong!`  to the channel
- `!sheet`: Replies with link to con set list google sheet
- `!add <text>`: Adds "text" to notes section of con set list
- `!help`: Replies with list of commands

### Manager

- `MANAGER: ping`: Messages `screw off` to the channel
- `MANAGER: reboot`: Reboots Hayasaka with code currently on master branch

## How to

### Add a command
1. Create a new `<command>.js` file
1. Import the `<command>.js` file in `hayasaka/main.js`
1. Add a case for the command in `hayasaka/main.js`
1. ???
1. profit

### Temporary manual testing

1. Create a [Google Cloud project](https://console.developers.google.com/)
1. Enable the Google Sheets API.
1. Under APIs \& Services -> Credentials -> Create Credentials, select "Service Account Key".
1. Give the account a name, and user the JSON key type.
1. Create the credentials and download it somewhere safe. Rename this as (your personal) `keys.json` file.
1. Send an invitation to edit the google spreadsheet to the value listed in the `client_email` field of `keys.json`.
1. Create a new application on the [Discord developer portal](https://discordapp.com/developers/applications/).
1. Head to Settings -> Bot and make the application a bot.
1. Invite the bot to your personal discord server
1. Under Bot Permissions, check "Send Messages" and "Read Message History"
1. Save changes to the bot
1. Reveal your bot's token and copy it into the `keys.json` generated by Google. Your `keys.json` should now have an entry that reads `bot_token: <SOME GUID>`
1. Place your personal `keys.json` file into the root directory of the hayasaka repo (move the real one somewhere else for testing)
1. In `hayasaka/conf.json`, change the `spreadsheet_id` to the ID in the URL of your testing spreadsheet (`https://docs.google.com/spreadsheets/d/`**spreadsheetId**`/edit#gid=0`).
1. In `hayasaka/conf.json`, change the `spreadsheet_dst` to the ID in the URL of your testing spreadsheet. Refer to the [Google Spreadsheet API](https://developers.google.com/sheets/api/guides/values#appending_values) for specifics.
1. Run hayasaka with `npm start`.
